# zdlang-agent Web 版本使用说明

## 功能说明
zdlang-agent Web 版本提供了一个独立的网页界面，让你可以通过浏览器使用智能代理功能。系统直接调用 Ollama API，无需依赖 Open-WebUI。

## 系统架构

### 核心组件
- **Web 界面**：Flask 提供的网页聊天界面
- **Ollama API**：直接调用本地 deepseek-r1-7b 模型
- **mcp-server**：天气查询服务
- **智能路由**：自动识别问题类型并调用相应服务

### 服务依赖
- **Ollama**：`http://localhost:11434` (deepseek-r1-7b 模型)
- **mcp-server**：`http://localhost:8081` (天气查询)
- **Web 服务**：`http://localhost:5000` (聊天界面)

## 安装和运行

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 确保服务运行
- Ollama 服务已启动（端口 11434）
- mcp-server 已启动（端口 8081）

### 3. 测试服务
```bash
python test_ollama.py
```

### 4. 启动 Web 服务
```bash
python web_agent.py
```

### 5. 访问网页界面
打开浏览器，访问：`http://localhost:5000`

## 使用方法

### 在网页界面中：
1. **天气查询**：输入包含"天气"的问题，如：
   - "北京天气怎么样？"
   - "查询武汉的天气"
   - "上海今天气温如何"

2. **其他问题**：输入任何其他问题，将调用本地大模型回答：
   - "讲个笑话"
   - "什么是人工智能？"
   - "帮我写一首诗"

### 智能路由
- Agent 会自动识别你的问题类型
- 天气相关问题 → 调用 mcp-server 查询天气
- 其他问题 → 调用 Ollama 的 deepseek-r1-7b 模型

## 界面特性

### 用户体验
- 🎨 现代化界面设计
- ⚡ 实时响应
- 🔄 加载状态提示
- ⌨️ 支持回车键发送
- 📱 响应式布局

### 功能特点
- 🤖 智能问题识别
- 🌤️ 天气信息查询
- 💬 自然语言对话
- 🔍 错误处理和提示

## 技术优势

### 相比 Open-WebUI 的优势
1. **独立运行**：不依赖 Open-WebUI，架构更简洁
2. **直接调用**：直接使用 Ollama API，减少中间层
3. **定制界面**：完全自定义的用户界面
4. **轻量级**：更少的依赖，更快的启动

### 性能优化
- 直接 API 调用，减少网络延迟
- 智能缓存和错误处理
- 异步处理提升响应速度

## 故障排除

### 如果无法访问网页：
1. 检查 Web 服务是否启动：`python web_agent.py`
2. 确认端口 5000 未被占用
3. 检查防火墙设置

### 如果天气查询失败：
1. 确认 mcp-server 正在运行
2. 检查端口 8081 是否正确
3. 验证 API 参数格式

### 如果大模型回答失败：
1. 确认 Ollama 正在运行：`ollama list`
2. 检查端口 11434 是否正确
3. 确认 deepseek-r1-7b 模型已加载
4. 运行测试脚本：`python test_ollama.py`

## 开发扩展

### 添加新功能
1. 在 `process_agent_query` 函数中添加新的路由逻辑
2. 创建新的工具函数
3. 更新前端界面

### 自定义模型
修改 `ask_ollama` 函数中的模型名称：
```python
"model": "your-model-name"
```

### 添加新服务
1. 创建新的 API 调用函数
2. 在路由逻辑中集成
3. 更新测试脚本 